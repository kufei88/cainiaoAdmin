(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ba57"],{ba57:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.showadd()}}},[t._v("新增合同")]),a("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.shownext()}}},[t._v("合同详情")]),a("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.showRadd()}}},[t._v("续租")]),a("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.showChange()}}},[t._v("合同变更")]),a("Button",{attrs:{type:"primary",loading:t.exportLoading,ghost:""},on:{click:t.exportExcel}},[t._v("导出")]),a("Modal",{attrs:{title:"变更合同"},model:{value:t.modal7,callback:function(e){t.modal7=e},expression:"modal7"}},[a("Form",{ref:"changeData",attrs:{model:t.changeData,rules:t.changeDatarules,"label-width":80}},[a("FormItem",{attrs:{label:"变更业主名",prop:"owner"}},[a("Input",{attrs:{type:"text"},model:{value:t.changeData.owner,callback:function(e){t.$set(t.changeData,"owner",e)},expression:"changeData.owner"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modal7=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.changeContract()}}},[t._v("确定")])],1)],1),a("Modal",{attrs:{title:"合同详情",width:"800"},model:{value:t.modal2,callback:function(e){t.modal2=e},expression:"modal2"}},[a("div",{staticStyle:{"text-align":"center"}},[a("h2",[t._v("公司:"+t._s(t.selectRowData.owner))])]),a("div",[a("h3",[t._v("租赁宿舍:"+t._s(t.selectRowData.buildingName))]),a("span",{staticStyle:{"margin-right":"20px"}},[t._v("联系人:"+t._s(t.ownerdata.enterprisePerson))]),a("span",[t._v("联系电话:"+t._s(t.ownerdata.contactNumber))])]),a("Table",{ref:"table",attrs:{border:"",columns:t.renewalColumns,data:t.rewData,height:"300"},scopedSlots:t._u([{key:"owner",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].owner))])]}},{key:"contractType",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].contractType))])]}},{key:"startDate",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].continueStartTime))])]}},{key:"endDate",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].continueEndTime))])]}},{key:"leasePeriod",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].continuePeriod))])]}},{key:"remark",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].totalCost))])]}},{key:"insertTime",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.rewData[o].insertTime))])]}}])})],1),a("Modal",{attrs:{title:"租赁房号"},model:{value:t.modal5,callback:function(e){t.modal5=e},expression:"modal5"}},[a("Table",{ref:"table",attrs:{border:"",columns:t.fangjianColumns,data:t.fangjianData,height:"300"},scopedSlots:t._u([{key:"roomNumber",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.fangjianData[o].roomNumber))])]}}])}),a("span",[t._v("共"+t._s(t.roomAll)+"条")]),a("Page",{attrs:{total:t.roomAll,"page-size":5},on:{"on-change":t.roompage}}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modal5=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.modal5=!1}}},[t._v("确定")])],1)],1),a("Modal",{attrs:{title:"新增合同","mask-closable":!1},on:{"on-cancel":function(e){t.conceldata()}},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[a("Form",{ref:"formCustom",attrs:{model:t.editDtae,rules:t.ruleCustom,"label-width":80}},[a("FormItem",{attrs:{label:"公司名称",prop:"companyName"}},[a("Input",{attrs:{type:"text"},model:{value:t.editDtae.companyName,callback:function(e){t.$set(t.editDtae,"companyName",e)},expression:"editDtae.companyName"}})],1),a("FormItem",{attrs:{label:"所属宿舍楼",prop:"buildingName"}},[a("Select",{staticStyle:{width:"200px"},attrs:{"transfer:true":""},model:{value:t.editDtae.buildingName,callback:function(e){t.$set(t.editDtae,"buildingName",e)},expression:"editDtae.buildingName"}},t._l(t.dormitorydata,function(e){return a("Option",{key:e.buildingName,attrs:{value:e.buildingName}},[t._v(t._s(e.buildingName))])}))],1),a("FormItem",{attrs:{label:"房间类型",prop:"roomType"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.editDtae.roomType,callback:function(e){t.$set(t.editDtae,"roomType",e)},expression:"editDtae.roomType"}},t._l(t.roomTypeData,function(e){return a("Option",{key:e.id,attrs:{value:e.roomType},nativeOn:{click:function(a){t.chioce(e)}}},[t._v(t._s(e.roomType))])})),a("Button",{attrs:{type:"primary",disabled:t.buttonflag,ghost:""},on:{click:function(e){t.showdorms()}}},[t._v("选择寝室")])],1),a("FormItem",{attrs:{label:"租期",prop:"leasePeriod"}},[a("Input",{attrs:{type:"text"},model:{value:t.editDtae.leasePeriod,callback:function(e){t.$set(t.editDtae,"leasePeriod",e)},expression:"editDtae.leasePeriod"}})],1),a("FormItem",{attrs:{label:"开始日期",prop:"startDate"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd"},on:{"on-change":t.dateChange},model:{value:t.editDtae.startDate,callback:function(e){t.$set(t.editDtae,"startDate",e)},expression:"editDtae.startDate"}})],1),a("FormItem",{attrs:{label:"结束日期",prop:"endDate"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd",readonly:!0},on:{"on-change":t.endChange},model:{value:t.editDtae.endDate,callback:function(e){t.$set(t.editDtae,"endDate",e)},expression:"editDtae.endDate"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.conceldata()}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.pushdata("formCustom")}}},[t._v("确定")])],1)],1),a("Modal",{attrs:{title:"续租合同"},model:{value:t.modal3,callback:function(e){t.modal3=e},expression:"modal3"}},[a("Form",{ref:"xuzuData",attrs:{model:t.xuzuData,rules:t.xuzuDatarules,"label-width":80}},[a("FormItem",{attrs:{label:"租期",prop:"continuePeriod"}},[a("Input",{attrs:{type:"text"},model:{value:t.xuzuData.continuePeriod,callback:function(e){t.$set(t.xuzuData,"continuePeriod",e)},expression:"xuzuData.continuePeriod"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modal3=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.saveXuzu()}}},[t._v("确定")])],1)],1),a("Modal",{attrs:{title:"选择房号"},model:{value:t.modal4,callback:function(e){t.modal4=e},expression:"modal4"}},[a("Table",{ref:"table",attrs:{border:"",height:"300",columns:t.dormColumns,data:t.dormsData},on:{"on-select-all":t.selectDrom,"on-select":t.selectDrom,"on-select-cancel":t.cancelSelect,"on-select-all-cancel":t.cancelAll},scopedSlots:t._u([{key:"roomNumber",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.dormsData[o].roomNumber))])]}}])}),a("span",[t._v("共"+t._s(t.dormAll)+"条")]),a("Page",{attrs:{total:t.dormAll,"page-size":5},on:{"on-change":t.dormpage}}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modal4=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.savedorms()}}},[t._v("确定")])],1)],1),a("Modal",{attrs:{title:"提示"},model:{value:t.modal6,callback:function(e){t.modal6=e},expression:"modal6"}},[a("p",[t._v("是否确定删除")]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modal6=!1}}},[t._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.deleterow()}}},[t._v("确定")])],1)]),a("Input",{staticStyle:{width:"300px"},attrs:{search:"","enter-button":"",placeholder:"请输入公司名"},on:{"on-search":function(e){t.getNameCount()}},model:{value:t.cname.name,callback:function(e){t.$set(t.cname,"name",e)},expression:"cname.name"}}),a("Table",{ref:"table",attrs:{border:"",columns:t.accountColumns,data:t.accountData,height:"520","highlight-row":""},on:{"on-current-change":t.rowSelect},scopedSlots:t._u([{key:"companyName",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].owner))])]}},{key:"roomNumber",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].roomNumber))])]}},{key:"startDate",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].startRentTime))])]}},{key:"endDate",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].endRentTime))])]}},{key:"totalLeasePeriod",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].totalPeriod))])]}},{key:"totalCost",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].totalCost))])]}},{key:"insertTime",fn:function(e){e.row;var o=e.index;return[a("span",[t._v(t._s(t.accountData[o].insertTime))])]}},{key:"action",fn:function(e){var o=e.row,n=e.index;return[t.editIndex===n?a("div",[a("Button",{on:{click:function(e){t.save(o)}}},[t._v("保存")]),a("Button",{on:{click:function(e){t.concel()}}},[t._v("取消")])],1):a("div",[a("Button",{on:{click:function(e){t.deleteaccount(o)}}},[t._v("删除")])],1)]}}])}),a("span",[t._v("共"+t._s(t.dormCounts)+"条")]),a("Page",{attrs:{total:t.dormCounts,"show-sizer":"",current:t.pagenum.startnum},on:{"on-change":t.handlePage,"on-page-size-change":t.pagesize}})],1)},n=[],r=(a("28a5"),a("6b54"),a("7f7f"),a("66df")),i=a("0a21"),s={data:function(){var t=function(t,e,a){""===e?a(new Error("公司名称不能为空")):a()},e=function(t,e,a){""===e?a(new Error("业主称不能为空")):a()},a=function(t,e,a){""===e?a(new Error("联系人不能为空")):a()},o=function(t,e,a){""===e?a(new Error("联系电话不能为空")):a()},n=function(t,e,a){""===e?a(new Error("宿舍号不能为空")):a()},r=function(t,e,a){""===e?a(new Error("起始日期不能为空")):a()},i=function(t,e,a){""===e?a(new Error("租期不能为空")):a()},s=function(t,e,a){""===e?a(new Error("续租租期不能为空")):a()};return{ownerdata:{enterprisePerson:"",contactNumber:""},roomAll:0,buttonflag:!0,dormAll:0,dormCounts:0,pagenum:{startnum:1,pagecount:10},uploadLoading:!1,progressPercent:0,showProgress:!1,showRemoveFile:!1,file:null,tableData:[],tableTitle:[],tableLoading:!1,fangjianColumns:[{title:"房间号",slot:"roomNumber",key:"roomNumber"}],dormColumns:[{type:"selection",width:60,align:"center"},{title:"房间号",slot:"roomNumber",key:"roomNumber"}],renewalColumns:[{type:"index",width:60,align:"center",render:function(t,e){return t("span",e.index+1)}},{title:"业主",slot:"owner",key:"owner"},{title:"合同类型",slot:"contractType",key:"contractType"},{title:"起始日期",slot:"startDate",key:"startDate"},{title:"结束日期",slot:"endDate",key:"endDate"},{title:"租期",slot:"leasePeriod",key:"leasePeriod"},{title:"租金",slot:"remark",key:"remark"},{title:"创建日期",slot:"insertTime",key:"insertTime"}],accountColumns:[{type:"index",width:60,align:"center",indexMethod:function(t){return t._index+1+(t.pageCurrent-1)*t.pageSize}},{title:"公司名称",slot:"companyName",key:"companyName"},{title:"寝室房间号",slot:"roomNumber",key:"roomNumber"},{title:"起始日期",slot:"startDate",key:"startDate"},{title:"结束日期",slot:"endDate",key:"endDate"},{title:"总租期",slot:"totalLeasePeriod",key:"totalLeasePeriod"},{title:"总租金",slot:"totalCost",key:"totalCost"},{title:"创建时间",slot:"insertTime",key:"insertTime"},{title:"操作",slot:"action",width:150,align:"center"}],accountData:[],editIndex:-1,cname:{name:"",spg:1,spgsize:10},ruleCustom:{companyName:[{validator:t,trigger:"blur"}],contact:[{validator:a,trigger:"blur"}],contactNumber:[{validator:o,trigger:"blur"}],roomType:[{validator:n,trigger:"onchange"}],startDate:[{validator:r,trigger:"blur"}],leasePeriod:[{validator:i,trigger:"blur"}]},changeDatarules:{owner:[{validator:e,trigger:"blur"}]},xuzuDatarules:{continuePeriod:[{validator:s,trigger:"blur"}]},tagname:{companyName:"公司名称",contact:"联系人",contactNumber:"联系电话",roomType:"房间类型",leasePeriod:"租期",remark:"租金"},renewalData:{nid:"",startDate:"",endDate:"",leasePeriod:"",remark:"",count:""},xuzuData:{owner:"",contractId:"",contractType:"",continueStartTime:"",continueEndTime:"",continuePeriod:"",totalCost:"",insertTime:"",unityPrice:""},changeData:{owner:"",contractId:"",contractType:"",continueStartTime:"",continueEndTime:"",continuePeriod:"",totalCost:"",insertTime:""},rooms:{buildingName:"",roomtype:"",pagedom:1},dormsData:[],fangjianData:[],rewData:[],editDtae:{companyName:"",buildingName:"",roomType:"",startDate:"",endDate:"",leasePeriod:"",remark:"",insertTime:"",selectdatas:[]},flag:!1,roomTypeData:[],modal1:!1,modal2:!1,modal3:!1,modal4:!1,modal5:!1,modal6:!1,modal7:!1,rt:"",monthmoney:"",dormitorydata:[],selectionData:[],selectionDatas:[],dmst:{owner:"",buildingName:"",startpage:1},isSelectrow:!1,selectRowData:"",deleterowdata:"",firstdata:{continueStartTime:"",continueEndTime:"",continuePeriod:"",totalCost:"",insertTime:""},modelData:[{companyName:"请输入公司名称",buildingName:"输入寝室楼栋名字",startDate:"输入起租日期 如2019/9/9",leasePeriod:"请输入数字",remark:"请输入数字 如1000",roomNumber:"请输入数字 如101,102,103...."}],exportLoading:!1,exportLoading1:!1}},components:{},computed:{},mounted:function(){this.getaccountData0(),this.getdormCount(),this.getRoomType()},methods:{getRoomType:function(){var t=this;r["a"].request({url:"/RoomType/getRoomTypes",method:"get"}).then(function(e){t.roomTypeData=e.data})},roompage:function(t){this.dmst.startpage=t,this.selectDromData()},exportExcel1:function(){if(this.modelData.length){this.exportLoading1=!0;var t={title:["公司名称","租赁寝室楼","起租时间","租期","总租金","租赁房间号"],key:["companyName","buildingName","startDate","leasePeriod","remark","roomNumber"],data:this.modelData,autoWidth:!0,filename:"模板下载"};i["a"].export_array_to_excel(t),this.exportLoading1=!1}else this.$Message.info("表格数据不能为空！")},exportExcel:function(){if(this.accountData.length){this.exportLoading=!0;var t={title:["公司名称","起租日期","结束日期","租赁寝室楼栋","房间号","租赁合同签署日期","总租期","总租金"],key:["owner","startRentTime","endRentTime","buildingName","roomNumber","insertTime","totalPeriod","totalCost"],data:this.accountData,autoWidth:!0,filename:"合同导出"};i["a"].export_array_to_excel(t),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")},showfangjian:function(){this.dmst.buildingName=this.selectRowData.buildingName,this.dmst.owner=this.selectRowData.owner,this.selectDromDataCount(),this.selectDromData(),this.modal5=!0},conceldata:function(){this.rooms.roomtype="",this.rooms.pagedom=1,this.selectionDatas=[],this.modal1=!1,this.buttonflag=!0},savedorms:function(){this.selectionDatas=this.selectionDatas.concat(this.selectionData),this.modal4=!1,this.editDtae.selectdatas=this.selectionDatas,this.selectionData=[]},cancelAll:function(t){for(var e=this,a=0;a<e.dormsData.length;a++)for(var o=0;o<e.selectionDatas.length;o++)e.dormsData[a].id==e.selectionDatas[o].id&&e.selectionDatas.splice(o,1)},cancelSelect:function(t,e){var a=this;this.selectionData=t;for(var o=0;o<a.dormsData.length;o++)for(var n=0;n<a.selectionDatas.length;n++)a.dormsData[o].roomNumber==a.selectionDatas[n].roomNumber&&a.selectionDatas.splice(n,1)},selectDrom:function(t){this.selectionData=t},getdormsCount:function(t){var e=this;r["a"].request({url:"/Account/getRoomListCount",method:"get",params:t}).then(function(t){e.dormAll=t.data})},dormpage:function(t){this.rooms.pagedom=t,this.selectionDatas=this.selectionDatas.concat(this.selectionData),this.selectionData=[],this.getdormsData(this.rooms)},showdorms:function(){this.getdormsData(this.rooms),this.getdormsCount(this.rooms),this.modal4=!0},selectDromDataCount:function(){var t=this;r["a"].request({url:"/Account/getRoomListCount2",method:"get",params:t.dmst}).then(function(e){t.roomAll=e.data})},selectDromData:function(){var t=this;r["a"].request({url:"/Account/getRoomList2",method:"get",params:t.dmst}).then(function(e){t.fangjianData=e.data})},getdormsData:function(t){var e=this;r["a"].request({url:"/Account/getRoomList",method:"get",params:t}).then(function(t){e.dormsData=t.data;for(var a=0;a<e.dormsData.length;a++)for(var o=0;o<e.selectionDatas.length;o++)e.dormsData[a].roomNumber==e.selectionDatas[o].roomNumber&&e.$set(e.dormsData[a],"_checked",!0)})},pagesize:function(t){var e=this;this.pagenum.pagecount=t,this.cname.spgsize=t,""!=e.cname.name?(console.log(e.cname),e.getNameCount()):this.getdormCount()},handlePage:function(t){var e=this;this.pagenum.startnum=t,this.cname.spg=t,""!=e.cname.name?e.getNameCount():this.getdormCount()},getdormCount:function(){var t=this;r["a"].request({url:"/Account/getAccountCount",method:"post"}).then(function(e){t.dormCounts=e.data,t.getaccountData(t.pagenum)})},saveXuzu:function(){var t=this,e=this;e.$refs["xuzuData"].validate(function(e){e&&(t.xuzuData.contractType="续租",t.xuzuData.totalCost=parseInt(t.xuzuData.continuePeriod)*t.xuzuData.unityPrice,t.xuzuData.continueStartTime=t.rewData[0].continueEndTime,t.xuzuData.insertTime=t.getFormatDate(),t.insertRenewal(t.xuzuData),t.modal3=!1)})},insertRenewal:function(t){var e=this;r["a"].request({url:"/Renewal/insertRenewals",method:"post",headers:{"Content-Type":"application/json"},data:t}).then(function(t){t.data>0?(e.$Message.success("续租成功"),e.getaccountData(e.pagenum)):e.$Message.warning("续租失败"),e.xuzuData.continuePeriod=""})},rowSelect:function(t,e){this.isSelectrow=!0;var a=this;for(var o in this.selectRowData=t,t)if(null==t[o]&&"updateTime"!=o.toString())return!1;r["a"].request({url:"/Account/getRoomType",method:"post",headers:{"Content-Type":"application/json"},data:t}).then(function(t){a.getRoomMonthRent(t.data)}),this.renewalData.nid=t.contractId,this.changeData.contractId=t.contractId,this.changeData.totalCost=t.totalCost,this.changeData.continueStartTime=t.startRentTime,this.changeData.continueEndTime=t.endRentTime,this.changeData.continuePeriod=t.totalPeriod,this.xuzuData.owner=t.owner,this.xuzuData.contractId=t.contractId},getRoomMonthRent:function(t){var e=this;r["a"].request({url:"/RoomType/getMonthRent",method:"post",headers:{"Content-Type":"application/json"},data:{roomType:t}}).then(function(t){e.xuzuData.unityPrice=t.data})},dateChange:function(t){this.editDtae.startDate=t,this.endChange(this.addMonth(t,parseInt(this.editDtae.leasePeriod)))},endChange:function(t){this.editDtae.endDate=t.toString()},addMonth:function(t,e){var a=t.split("-"),o=parseInt(a[0]),n=parseInt(a[1]-1),r=parseInt(a[2]),i=new Date(o,n,r);i.setMonth(i.getMonth()+e),12*i.getFullYear()+i.getMonth()>12*o+n+e&&(i=new Date(i.getFullYear(),i.getMonth(),0));var s=i.getFullYear(),l=i.getMonth()+1,c=i.getDate(),u=s+"-"+l+"-"+c;return u},pushdata:function(t){var e=this,a=this;a.editDtae.remark=0,a.$refs["formCustom"].validate(function(t){if(t){if(a.editDtae.remark=a.monthmoney*a.editDtae.leasePeriod,a.editDtae.insertTime=a.getFormatDate(),a.selectionDatas.length<=0)return e.$Message.warning("请选择寝室房号"),!1;r["a"].request({url:"/Account/getCompanyName",method:"get",params:{companyName:a.editDtae.companyName}}).then(function(t){1==t.data?(a.insert(a.editDtae),a.modal1=!1):0==t.data&&a.$Message.error("该公司不存在")})}})},showadd:function(){this.$refs["formCustom"].resetFields(),this.getdormitoryData();var t=this;for(var e in t.editDtae)t.editDtae[e]="";this.modal1=!0},showChange:function(){if(0==this.isSelectrow)return this.$Message.warning("请选择合同"),!1;this.$refs["changeData"].resetFields(),this.changeData.owner="",this.modal7=!0},changeContract:function(){var t=this;this.$refs["changeData"].validate(function(e){e&&r["a"].request({url:"/Account/getCompanyName",method:"get",params:{companyName:t.changeData.owner}}).then(function(e){1==e.data?(t.insertRenewal2(),t.modal7=!1):0==e.data&&t.$Message.error("该公司不存在")})})},insertRenewal2:function(){var t=this;t.changeData.insertTime=t.getFormatDate(),t.changeData.contractType="变更",r["a"].request({url:"/Renewal/insertRenewals2",method:"post",headers:{"Content-Type":"application/json"},data:t.changeData}).then(function(e){1==e.data?(t.$Message.success("合同变更成功"),r["a"].request({url:"/Renewal/updateRoom",method:"post",headers:{"Content-Type":"application/json"},data:{owner:t.changeData.owner,buildingName:t.selectRowData.buildingName,roomNumber:t.selectRowData.roomNumber}})):t.$Message.error("合同变更失败"),t.getdormCount(),t.modal7=!1})},showRadd:function(){this.$refs["xuzuData"].resetFields(),this.xuzuData.continuePeriod="";var t=this;if(0==this.isSelectrow)return this.$Message.warning("请选择合同"),!1;t.getRenwealData(t.renewalData),this.modal3=!0},getRenwealData:function(t){var e=this;r["a"].request({url:"/Renewal/getRenewalList",method:"get",params:t}).then(function(t){e.rewData=t.data})},getRenwealCount:function(t){var e=this;r["a"].request({url:"/Renewal/getCount",method:"get",params:t}).then(function(t){e.renewalData.count=t.data})},shownext:function(){var t=this;if(0==this.isSelectrow)return this.$Message.warning("请选择合同"),!1;this.getRenwealData(t.renewalData),this.getOwnerList()},getOwnerList:function(){var t=this;r["a"].request({url:"/Account/getOwnerList",method:"get",params:{owner:t.selectRowData.owner}}).then(function(e){t.ownerdata=e.data[0],t.modal2=!0})},show:function(t){this.editIndex=t},chioce:function(t){this.rooms.roomtype=t.roomType,this.rooms.buildingName=this.editDtae.buildingName,this.buttonflag=!1,this.monthmoney=t.monthRent},save:function(t){var e=this;for(var a in t)if(""==t[a])return this.$Message.error(e.tagname[a]+"不能为空"),!1;this.update(t),this.editIndex=-1},concel:function(){var t=this;t.getdormCount(),this.editIndex=-1},deleteaccount:function(t){this.modal6=!0,this.deleterowdata=t},deleterow:function(){var t=this;r["a"].request({url:"/Account/deleteAccount",method:"post",headers:{"Content-Type":"application/json"},data:t.deleterowdata}).then(function(e){1!=t.dormCounts&&t.dormCounts%10==1&&(t.pagenum.startnum-=1),t.getdormCount(),e.data>0&&t.$Message.success("合同删除成功"),t.modal6=!1})},update:function(t){var e=this;r["a"].request({url:"/Account/updateAccount",method:"post",headers:{"Content-Type":"application/json"},data:t}).then(function(t){t.data>0&&e.$Message.success("合同更新成功"),e.getdormCount()})},insert:function(t){var e=this;r["a"].request({url:"/Account/insertAccount",method:"post",headers:{"Content-Type":"application/json"},data:t}).then(function(t){t.data>0?e.$Message.success("合同新增成功"):e.$Message.warning("合同新增失败"),e.getdormCount(),e.rooms.roomtype="",e.rooms.pagedom=1,e.selectionDatas=[],e.buttonflag=!0})},uploader:function(t){r["a"].request({url:"/Account/uploadAccount",method:"post",params:t})},getdormitoryData:function(){var t=this;r["a"].request({url:"/Account/getBuildingList",method:"get"}).then(function(e){t.dormitorydata=e.data,t.editDtae.buildingName=e.data[0].buildingName})},getaccountData0:function(){var t=this;r["a"].request({url:"/Account/getAccountList0",method:"get"}).then(function(e){t.accountData=e.data,t.addPageCurrentAndPageSize(t.accountData)})},getaccountData:function(t){var e=this;r["a"].request({url:"/Account/getAccountList",method:"get",params:t}).then(function(t){e.accountData=t.data,e.addPageCurrentAndPageSize(e.accountData)})},getListByname:function(){var t=this;r["a"].request({url:"/Account/getNameList",method:"get",params:t.cname}).then(function(e){t.accountData=e.data})},getNameCount:function(){var t=this;r["a"].request({url:"/Account/getNameCount",method:"get",params:t.cname}).then(function(e){t.dormCounts=e.data,t.getListByname()})},initUpload:function(){this.file=null,this.showProgress=!1,this.loadingProgress=0,this.tableData=[],this.tableTitle=[]},handleUploadFile:function(){this.initUpload()},handleRemove:function(){this.initUpload(),this.$Message.info("上传的文件已删除！")},handleBeforeUpload:function(t){var e=t.name.split(".").pop().toLocaleLowerCase();return"xlsx"===e||"xls"===e?(this.readFile(t),this.file=t):this.$Notice.warning({title:"文件类型错误",desc:"文件："+t.name+"不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。"}),!1},readFile:function(t){var e=this,a=new FileReader;a.readAsArrayBuffer(t),a.onloadstart=function(t){e.uploadLoading=!0,e.tableLoading=!0,e.showProgress=!0},a.onprogress=function(t){e.progressPercent=Math.round(t.loaded/t.total*100)},a.onerror=function(t){e.$Message.error("文件读取出错")},a.onload=function(t){var a=e,o=t.target.result,n=i["a"].read(o,"array"),r=n.header,s=n.results,l=r.map(function(t){return{title:t,key:t}});e.tableData=s,e.tableTitle=l,e.uploadLoading=!1,e.tableLoading=!1,e.showRemoveFile=!0,a.uploadExcelData(e.tableData)}},uploadExcelData:function(t){var e=[];for(var a in t)t[a].companyName=t[a].公司名称,t[a].buildingName=t[a].租赁寝室楼,t[a].startDate=t[a].起租时间,t[a].leasePeriod=t[a].租期,t[a].remark=t[a].总租金,t[a].roomNumber=t[a].租赁房间号,t[a].insertTime=this.getFormatDate(),delete t[a].公司名称,delete t[a].租赁寝室楼,delete t[a].起租时间,delete t[a].租期,delete t[a].总租金,delete t[a].租赁房间号,e=e.concat(t[a]);var o=0;for(var a in t)void 0==t[a].companyName||null==t[a].companyName||""==t[a].companyName||void 0==t[a].buildingName||null==t[a].buildingName||""==t[a].buildingName||void 0==t[a].startDate||null==t[a].startDate||""==t[a].startDate||void 0==t[a].leasePeriod||null==t[a].leasePeriod||""==t[a].leasePeriod||void 0==t[a].remark||null==t[a].remark||""==t[a].remark||void 0==t[a].roomNumber||null==t[a].roomNumber||""==t[a].roomNumber?o+=1:o+=0;0==o?this.uploadf(e):(this.$Message.error("该表内有"+o+"行数据有空项"),e=[],o=0)},uploadf:function(t){var e=this;r["a"].request({url:"/Account/uploadAccount",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t}).then(function(t){1==t.data?(e.$Message.success("上传成功"),e.getdormCount()):-1==t.data?e.$Message.error("表中存在已被出租的房间"):-4==t.data?e.$Message.error("表中宿舍楼栋不存在"):e.$Message.error("发生未知错误")})},getFormatDate:function(){var t=new Date,e=t.getMonth()+1,a=t.getDate();e>=1&&e<=9&&(e="0"+e),a>=0&&a<=9&&(a="0"+a);var o=t.getFullYear()+"-"+e+"-"+a+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return o},addPageCurrentAndPageSize:function(t){for(var e in t)t[e].pageCurrent=this.pagenum.startnum,t[e].pageSize=this.pagenum.pagecount}}},l=s,c=a("2877"),u=Object(c["a"])(l,o,n,!1,null,null,null);u.options.__file="dormitorymanage.vue";e["default"]=u.exports}}]);