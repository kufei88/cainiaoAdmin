(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2734"],{5708:function(e,t,a){"use strict";var o=a("dce8"),r=a.n(o);r.a},dce8:function(e,t,a){},f963:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Input",{staticStyle:{width:"300px","margin-bottom":"10px",float:"left"},attrs:{search:"","enter-button":"查询",placeholder:"请输入查询关键字，如所属楼栋、业主"},on:{"on-search":e.searchButton},model:{value:e.searchData,callback:function(t){e.searchData=t},expression:"searchData"}}),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-download",loading:e.exportLoading},on:{click:e.exportExcelModel}},[e._v("模板下载")]),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-download",loading:e.exportLoading},on:{click:e.exportExcel}},[e._v("导出文件")]),a("Upload",{staticStyle:{float:"right"},attrs:{action:"","before-upload":e.handleBeforeUpload,accept:".xls, .xlsx"}},[a("Button",{attrs:{icon:"ios-cloud-upload-outline",loading:e.uploadLoading},on:{click:e.handleUploadFile}},[e._v("上传文件")])],1),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-add"},on:{click:function(t){e.isAddNewData=!0}}},[e._v("新增")]),a("div",{staticStyle:{clear:"both"}}),a("Modal",{attrs:{closable:!1,"mask-closable":!1,title:"新增办公室信息填写"},model:{value:e.isAddNewData,callback:function(t){e.isAddNewData=t},expression:"isAddNewData"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"所属宿舍楼",prop:"buildingName"}},[a("Select",{staticStyle:{width:"200px"},attrs:{"transfer:true":""},model:{value:e.formValidate.buildingName,callback:function(t){e.$set(e.formValidate,"buildingName",t)},expression:"formValidate.buildingName"}},e._l(e.buildingData,function(t){return a("Option",{key:t.buildingName,attrs:{value:t.buildingName}},[e._v(e._s(t.buildingName))])}))],1),a("FormItem",{attrs:{label:"房号",prop:"roomNumber"}},[a("Input",{attrs:{clearable:""},model:{value:e.formValidate.roomNumber,callback:function(t){e.$set(e.formValidate,"roomNumber",t)},expression:"formValidate.roomNumber"}})],1),a("FormItem",{attrs:{label:"房间类型",prop:"roomType"}},[a("Select",{staticStyle:{width:"200px"},attrs:{"transfer:true":""},model:{value:e.formValidate.roomType,callback:function(t){e.$set(e.formValidate,"roomType",t)},expression:"formValidate.roomType"}},e._l(e.roomTypeDate,function(t){return a("Option",{key:t.id,attrs:{value:t.roomType}},[e._v(e._s(t.roomType))])}))],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(t){e.handleReset("formValidate")}}},[e._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("确定")])],1)],1),a("Table",{ref:"table",attrs:{border:"",columns:e.dataColumns,data:e.pageData,height:"522"},scopedSlots:e._u([{key:"id",fn:function(t){var o=t.row;return[a("span",[e._v(e._s(o.id))])]}},{key:"buildingName",fn:function(t){var o=t.row;return[a("span",[e._v(e._s(o.buildingName))])]}},{key:"roomNumber",fn:function(t){var o=t.row;return[a("span",[e._v(e._s(o.roomNumber))])]}},{key:"owner",fn:function(t){var o=t.row;return[a("span",[e._v(e._s(o.owner))])]}},{key:"roomType",fn:function(t){var o=t.row,r=t.index;return[e.editIndex===r?a("Select",{attrs:{"transfer:true":""},model:{value:e.editRoomType,callback:function(t){e.editRoomType=t},expression:"editRoomType"}},e._l(e.roomTypeDate,function(t){return a("Option",{key:t.id,attrs:{value:t.roomType}},[e._v(e._s(t.roomType))])})):a("span",[e._v(e._s(o.roomType))])]}},{key:"action",fn:function(t){var o=t.row,r=t.index;return[e.editIndex===r?a("div",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:function(t){e.handleSave(r)}}},[e._v("保存")]),a("Button",{attrs:{type:"error"},on:{click:function(t){e.handleCancel(r)}}},[e._v("取消")])],1):a("div",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:function(t){e.handleEdit(o,r)}}},[e._v("修改")]),a("Button",{attrs:{type:"error"},on:{click:function(t){e.handleDelete(r)}}},[e._v("删除")])],1)]}}])}),a("span",[e._v("记录总共 "+e._s(this.dataCount)+" 条")]),a("Page",{attrs:{total:e.dataCount,"show-sizer":"",current:e.pageCurrent,"page-size-opts":[10,20,50,100],align:"center"},on:{"on-change":e.changePage,"on-page-size-change":e.changePageNumber}})],1)},r=[],i=(a("28a5"),a("7f7f"),a("66df")),n=a("0a21"),s={data:function(){return{dataType:"宿舍",isAddNewData:!1,buildingData:[],roomTypeDate:[],formValidate:{roomNumber:"",buildingName:"",roomType:"",insertTime:""},ruleValidate:{roomNumber:[{required:!0,message:"房号不得为空",trigger:"blur"}],buildingName:[{required:!0,message:"所属宿舍楼不得为空",trigger:"change"}],roomType:[{required:!0,message:"房间类型不得为空",trigger:"change"}]},searchData:"",uploadLoading:!1,file:null,uploadTableData:[],exportLoading:!1,excelDataModel:[{roomNumber:"必须是数字，，例如:101",buildingName:"必须是宿舍楼的名称",roomType:"必须是存在的房间类型"}],editIndex:-1,editRentArea:"",editBuildingArea:"",editRoomType:"",pageCurrent:1,pageStart:0,pageEnd:0,dataCount:0,pageSize:10,pageData:[],dataColumns:[{type:"index",width:60,align:"center",indexMethod:function(e){return e._index+1+(e.pageCurrent-1)*e.pageSize}},{title:"所属楼栋",key:"buildingName",slot:"buildingName"},{title:"房号",key:"roomNumber",slot:"roomNumber"},{title:"业主",key:"owner",slot:"owner"},{title:"房间类型",key:"roomType",slot:"roomType"},{title:"添加时间",key:"insertTime"},{title:"修改时间",key:"updateTime"},{title:"操作",width:180,align:"center",slot:"action"}]}},methods:{handleSubmit:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var o=t,r=t.formValidate;r.insertTime=t.getFormatDate(),i["a"].request({url:"/room/insertRoomList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:r}).then(function(e){1==e.data?(o.$Message.success("添加成功"),o.getRequestData(o.pageCurrent)):-1==e.data?o.$Message.error("已有该房间存在"):o.$Message.error("添加失败")}).then(function(){o.$refs[e].resetFields()}),t.isAddNewData=!1}})},handleReset:function(e){this.$refs[e].resetFields(),this.isAddNewData=!1},uploadExcelData:function(e){for(var t in e)e[t].roomNumber=e[t].房号,e[t].buildingName=e[t].宿舍楼名称,e[t].roomType=e[t].房间类型,e[t].insertTime=this.getFormatDate(),delete e[t].房号,delete e[t].宿舍楼名称,delete e[t].房间类型;var a=0;for(var t in e)""==e[t].roomNumber||null==e[t].roomNumber||void 0==e[t].roomNumber||""==e[t].buildingName||null==e[t].buildingName||void 0==e[t].buildingName||""==e[t].roomType||null==e[t].roomType||void 0==e[t].roomType?a+=1:a+=0;if(0==a){var o=this;i["a"].request({url:"/room/uploadRoomList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e}).then(function(t){if(0==t.data)o.$Message.error("未知原因，导入失败");else if(-1==t.data)o.$Message.error("导入失败，表内无数据");else if(-2==t.data)o.$Message.error("导入失败，数据全部存在");else{if(t.data==e.length)o.$Message.success("导入成功");else if(t.data<e.length){var a=e.length-t.data;o.$Message.info(a+"条数据因无效而未导入")}o.getRequestData(o.pageCurrent)}})}else this.$Message.error("该表内有"+a+"行数据有空项"),a=0},initUpload:function(){this.file=null,this.uploadTableData=[]},handleUploadFile:function(){this.initUpload()},handleBeforeUpload:function(e){var t=e.name.split(".").pop().toLocaleLowerCase();return"xlsx"===t||"xls"===t?(this.readFile(e),this.file=e):this.$Notice.warning({title:"文件类型错误",desc:"文件："+e.name+"不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。"}),!1},readFile:function(e){var t=this,a=new FileReader;a.readAsArrayBuffer(e),a.onloadstart=function(e){t.uploadLoading=!0},a.onprogress=function(e){t.progressPercent=Math.round(e.loaded/e.total*100)},a.onerror=function(e){t.$Message.error("文件读取出错")},a.onload=function(e){var a=e.target.result,o=n["a"].read(a,"array"),r=(o.header,o.results);t.uploadTableData=r,t.uploadLoading=!1,t.uploadExcelData(t.uploadTableData)}},exportExcelModel:function(){if(this.excelDataModel.length){this.exportLoading=!0;var e={title:["房号","宿舍楼名称","房间类型"],key:["roomNumber","buildingName","roomType"],data:this.excelDataModel,autoWidth:!0,filename:"宿舍房间管理信息表模板"};n["a"].export_array_to_excel(e),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")},exportExcel:function(){if(this.pageData.length){this.exportLoading=!0;var e={title:["房号","宿舍楼名称","业主","房间类型"],key:["roomNumber","buildingName","owner","roomType"],data:this.pageData,autoWidth:!0,filename:"宿舍房间管理信息表"};n["a"].export_array_to_excel(e),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")},searchButton:function(e){this.searchData=e,this.pageCurrent=1,this.getRequestData(this.pageCurrent)},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"删除提示",content:"<p>是否确认删除该条记录？</p>",onOk:function(){var a=t,o=t.pageData[e];i["a"].request({url:"/room/deleteRoomList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:o}).then(function(e){1==e.data?(a.$Message.success("删除成功"),a.pageData.length<=1?a.getRequestData(a.pageCurrent-1):a.getRequestData(a.pageCurrent)):a.$Message.error("删除失败")})},onCancel:function(){}}),this.editIndex=-1},handleEdit:function(e,t){this.editRoomType=e.roomType,this.editIndex=t},handleCancel:function(e){this.editIndex=-1},handleSave:function(e){var t=this,a=this.pageData;this.pageData[e].roomType=this.editRoomType,""==this.pageData[e].roomType||null==this.pageData[e].roomType||void 0==this.pageData[e].roomType?this.$Message.error("有内容未填写"):(this.pageData[e].updateTime=this.getFormatDate(),a=this.pageData[e],i["a"].request({url:"/room/updateRoomList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:a}).then(function(e){1==e.data?t.$Message.success("保存成功"):-1==e.data?t.$Message.error("该楼已有该房号"):t.$Message.error("保存失败"),t.getRequestData(t.pageCurrent)}).then(function(){t.changePage(t.pageCurrent)}),this.editIndex=-1)},changePageNumber:function(e){this.pageSize=e,1===this.pageCurrent&&this.changePage(this.pageCurrent)},changePage:function(e){this.pageCurrent=e,this.getRequestData(e)},getRequestData:function(e){var t=this;this.pageStart=(e-1)*this.pageSize,i["a"].request({url:"/room/getSearchList",method:"get",params:{search:this.searchData,dataStart:this.pageStart,dataSize:this.pageSize,dataType:this.dataType}}).then(function(e){t.pageData=e.data.roomList,t.dataCount=e.data.dataCount,t.addPageCurrentAndPageSize(t.pageData)})},getBuildingData:function(){var e=this;i["a"].request({url:"/room/getBuildingList",method:"get",params:{dataType:this.dataType}}).then(function(t){e.buildingData=t.data,e.formValidate.buildingName=e.buildingData[0].buildingName})},getRoomType:function(){var e=this;i["a"].request({url:"/RoomType/getRoomTypes",method:"get"}).then(function(t){e.roomTypeDate=t.data})},getFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();t>=1&&t<=9&&(t="0"+t),a>=0&&a<=9&&(a="0"+a);var o=e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return o},addPageCurrentAndPageSize:function(e){for(var t in e)e[t].pageCurrent=this.pageCurrent,e[t].pageSize=this.pageSize}},mounted:function(){this.getRequestData(this.pageCurrent),this.getBuildingData(),this.getRoomType()}},l=s,d=(a("5708"),a("2877")),u=Object(d["a"])(l,o,r,!1,null,"2d6f0026",null);u.options.__file="room.vue";t["default"]=u.exports}}]);