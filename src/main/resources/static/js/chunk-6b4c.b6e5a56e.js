(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b4c"],{9546:function(e,t,a){"use strict";var i=a("b445"),n=a.n(i);n.a},b445:function(e,t,a){},f342:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Input",{staticStyle:{width:"300px","margin-bottom":"10px",float:"left"},attrs:{search:"","enter-button":"查询",placeholder:"请输入查询关键字，如楼栋名称、楼栋类型"},on:{"on-search":e.searchButton},model:{value:e.searchData,callback:function(t){e.searchData=t},expression:"searchData"}}),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-download",loading:e.exportLoading},on:{click:e.exportExcelModel}},[e._v("模板下载")]),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-download",loading:e.exportLoading},on:{click:e.exportExcel}},[e._v("导出文件")]),a("Upload",{staticStyle:{float:"right"},attrs:{action:"","before-upload":e.handleBeforeUpload,accept:".xls, .xlsx"}},[a("Button",{attrs:{icon:"ios-cloud-upload-outline",loading:e.uploadLoading},on:{click:e.handleUploadFile}},[e._v("上传文件")])],1),a("Button",{staticStyle:{float:"right"},attrs:{icon:"md-add"},on:{click:function(t){e.isAddNewData=!0}}},[e._v("新增")]),a("div",{staticStyle:{clear:"both"}}),a("Modal",{attrs:{closable:!1,"mask-closable":!1,title:"新增办公楼信息填写"},model:{value:e.isAddNewData,callback:function(t){e.isAddNewData=t},expression:"isAddNewData"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"楼栋名称",prop:"buildingName"}},[a("Input",{attrs:{clearable:""},model:{value:e.formValidate.buildingName,callback:function(t){e.$set(e.formValidate,"buildingName",t)},expression:"formValidate.buildingName"}})],1),a("FormItem",{attrs:{label:"楼栋类型",prop:"buildingType"}},[a("Select",{attrs:{transfer:""},model:{value:e.formValidate.buildingType,callback:function(t){e.$set(e.formValidate,"buildingType",t)},expression:"formValidate.buildingType"}},e._l(e.buildingTypeList,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:function(t){e.handleReset("formValidate")}}},[e._v("取消")]),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("确定")])],1)],1),a("Table",{ref:"table",attrs:{border:"",columns:e.dataColumns,data:e.pageData,height:"522"},scopedSlots:e._u([{key:"buildingName",fn:function(t){var i=t.row,n=t.index;return[e.editIndex===n?a("Input",{attrs:{type:"text"},model:{value:e.editBuildingName,callback:function(t){e.editBuildingName=t},expression:"editBuildingName"}}):a("span",[e._v(e._s(i.buildingName))])]}},{key:"buildingType",fn:function(t){var i=t.row,n=t.index;return[e.editIndex===n?a("Select",{attrs:{transfer:""},model:{value:e.editBuildingType,callback:function(t){e.editBuildingType=t},expression:"editBuildingType"}},e._l(e.buildingTypeList,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})):a("span",[e._v(e._s(i.buildingType))])]}},{key:"insertTime",fn:function(t){var i=t.row;t.index;return[a("span",[e._v(e._s(i.insertTime))])]}},{key:"updateTime",fn:function(t){var i=t.row;t.index;return[a("span",[e._v(e._s(i.updateTime))])]}},{key:"action",fn:function(t){var i=t.row,n=t.index;return[e.editIndex===n?a("div",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:function(t){e.handleSave(n)}}},[e._v("保存")]),a("Button",{attrs:{type:"error"},on:{click:function(t){e.handleCancel(n)}}},[e._v("取消")])],1):a("div",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:function(t){e.handleEdit(i,n)}}},[e._v("修改")]),a("Button",{attrs:{type:"error"},on:{click:function(t){e.handleDelete(n)}}},[e._v("删除")])],1)]}}])}),a("span",[e._v("记录总共 "+e._s(this.dataCount)+" 条")]),a("Page",{attrs:{total:e.dataCount,"show-sizer":"",current:e.pageCurrent,"page-size-opts":[10,20,50,100],align:"center"},on:{"on-change":e.changePage,"on-page-size-change":e.changePageNumber}})],1)},n=[],r=(a("28a5"),a("7f7f"),a("66df")),l=a("0a21"),s={data:function(){return{buildingTypeList:[{value:"办公",label:"办公"},{value:"仓办",label:"仓办"},{value:"宿舍",label:"宿舍"}],formValidate:{buildingName:"",buildingType:"",insertTime:this.getFormatDate()},ruleValidate:{buildingName:[{required:!0,message:"楼栋名称不得为空",trigger:"blur"}],buildingType:[{required:!0,message:"楼栋类型不得为空",trigger:"change"}]},isAddNewData:!1,uploadLoading:!1,file:null,uploadTableData:[],exportLoading:!1,excelModel:[{buildingName:"不能有特殊字符且不得为空，例如：1号楼",buildingType:"不能有特殊字符且不得为空，例如：办公、仓办、宿舍"}],searchData:"",editIndex:-1,editBuildingName:"",editBuildingType:"",pageCurrent:1,pageStart:0,dataCount:0,pageSize:10,pageData:[],dataColumns:[{type:"index",width:60,align:"center",indexMethod:function(e){return e._index+1+(e.pageCurrent-1)*e.pageSize}},{title:"楼栋名称",key:"buildingName",align:"center",slot:"buildingName"},{title:"楼栋类型",key:"buildingType",align:"center",slot:"buildingType"},{title:"添加时间",key:"insertTime",align:"center",slot:"insertTime"},{title:"修改时间",key:"updateTime",align:"center",slot:"updateTime"},{title:"操作",slot:"action",width:180,align:"center"}]}},methods:{handleDelete:function(e){var t=this;this.$Modal.confirm({title:"删除提示",content:"<p>是否确认删除该条记录？</p>",onOk:function(){var a=t,i=t.pageData[e];r["a"].request({url:"/building/deleteBuildingList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:i}).then(function(e){1==e.data?(a.$Message.success("删除成功"),a.pageData.length<=1&&1!=a.pageCurrent&&(a.pageCurrent=a.pageCurrent-1),a.getRequestData(a.pageCurrent)):a.$Message.error("删除失败")})},onCancel:function(){}}),this.editIndex=-1},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var i=t,n=t.formValidate;r["a"].request({url:"/building/insertBuildingList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:n}).then(function(e){1==e.data?(i.$Message.success("添加成功"),i.getRequestData(i.pageCurrent)):-1==e.data?i.$Message.error("已有该楼栋存在"):i.$Message.error("添加失败")}).then(function(){i.$refs[e].resetFields()}),t.isAddNewData=!1}})},handleReset:function(e){this.$refs[e].resetFields(),this.isAddNewData=!1},uploadExcelData:function(e){for(var t in e)e[t].buildingName=e[t].楼栋名称,e[t].buildingType=e[t].楼栋类型,e[t].insertTime=this.getFormatDate(),delete e[t].楼栋名称,delete e[t].楼栋类型;var a=0;for(var t in e)""==e[t].buildingName||null==e[t].buildingName||void 0==e[t].buildingName?a+=1:a+=0;if(0==a){var i=this;r["a"].request({url:"/building/uploadBuildingList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e}).then(function(t){if(0==t.data)i.$Message.error("未知原因，导入失败");else if(-1==t.data)i.$Message.error("导入失败，表内无数据");else if(-2==t.data)i.$Message.error("导入失败，数据全部存在");else{if(t.data==e.length)i.$Message.success("导入成功");else if(t.data<e.length){var a=e.length-t.data;i.$Message.info(a+"条数据因重复而未导入")}i.getRequestData(i.pageCurrent)}})}else this.$Message.error("该表内有"+a+"行数据有空项"),a=0},initUpload:function(){this.file=null,this.uploadTableData=[]},handleUploadFile:function(){this.initUpload()},handleBeforeUpload:function(e){var t=e.name.split(".").pop().toLocaleLowerCase();return"xlsx"===t||"xls"===t?(this.readFile(e),this.file=e):this.$Notice.warning({title:"文件类型错误",desc:"文件："+e.name+"不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。"}),!1},readFile:function(e){var t=this,a=new FileReader;a.readAsArrayBuffer(e),a.onloadstart=function(e){t.uploadLoading=!0},a.onprogress=function(e){t.progressPercent=Math.round(e.loaded/e.total*100)},a.onerror=function(e){t.$Message.error("文件读取出错")},a.onload=function(e){var a=e.target.result,i=l["a"].read(a,"array"),n=(i.header,i.results);t.uploadTableData=n,t.uploadLoading=!1,t.uploadExcelData(t.uploadTableData)}},exportExcel:function(){if(this.pageData.length){this.exportLoading=!0;var e={title:["楼栋名称","楼栋类型","添加时间","修改时间"],key:["buildingName","buildingType","insertTime","updateTime"],data:this.pageData,autoWidth:!0,filename:"办公楼管理表"};l["a"].export_array_to_excel(e),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")},exportExcelModel:function(){if(this.excelModel.length){this.exportLoading=!0;var e={title:["楼栋名称","楼栋类型"],key:["buildingName","buildingType"],data:this.excelModel,autoWidth:!0,filename:"办公楼管理表模板"};l["a"].export_array_to_excel(e),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")},searchButton:function(e){this.searchData=e,this.pageCurrent=1,this.getRequestData(this.pageCurrent)},changePageNumber:function(e){this.pageSize=e,1===this.pageCurrent&&this.changePage(this.pageCurrent)},changePage:function(e){this.pageCurrent=e,this.getRequestData(e)},handleEdit:function(e,t){this.editBuildingName=e.buildingName,this.editBuildingType=e.buildingType,this.editIndex=t},handleCancel:function(e){this.editIndex=-1},handleSave:function(e){var t=this;if(this.pageData[e].buildingType=this.editBuildingType,this.pageData[e].buildingName=this.editBuildingName,""==this.pageData[e].buildingType||null==this.pageData[e].buildingType||void 0==this.pageData[e].buildingType||""==this.pageData[e].buildingName||null==this.pageData[e].buildingName||void 0==this.pageData[e].buildingName)this.$Message.error("有内容未填写");else{var a=this.pageData[e];a.updateTime=this.getFormatDate(),r["a"].request({url:"/building/updateBuildingList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:a}).then(function(e){1==e.data?(t.$Message.success("保存成功"),t.getRequestData(t.pageCurrent)):-1==e.data?t.$Message.error("已有楼栋名称"):t.$Message.error("保存失败")}).then(function(){t.changePage(t.pageCurrent)}),this.editIndex=-1}},getRequestData:function(e){var t=this;this.pageStart=(e-1)*this.pageSize,r["a"].request({url:"/building/getSearchList",method:"get",params:{search:this.searchData,dataStart:this.pageStart,dataSize:this.pageSize}}).then(function(e){t.pageData=e.data.buildingList,t.dataCount=e.data.dataCount,t.addPageCurrentAndPageSize(t.pageData)})},getFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();t>=1&&t<=9&&(t="0"+t),a>=0&&a<=9&&(a="0"+a);var i=e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return i},addPageCurrentAndPageSize:function(e){for(var t in e)e[t].pageCurrent=this.pageCurrent,e[t].pageSize=this.pageSize}},mounted:function(){this.getRequestData(this.pageCurrent)}},o=s,d=(a("9546"),a("2877")),u=Object(d["a"])(o,i,n,!1,null,"efc068d8",null);u.options.__file="building.vue";t["default"]=u.exports}}]);